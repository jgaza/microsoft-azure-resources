{
	"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"location": {
			"type": "string",
			"defaultValue": "[resourceGroup().location]",
			"allowedValues": [
				"[resourceGroup().location]",
				"asia",
				"asiapacific",
				"australia",
				"australiacentral",
				"australiacentral2",
				"australiaeast",
				"australiasoutheast",
				"brazil",
				"brazilsouth",
				"brazilsoutheast",
				"canada",
				"canadacentral",
				"canadaeast",
				"centralindia",
				"centralus",
				"centraluseuap",
				"eastasia",
				"eastus",
				"eastus2",
				"eastus2euap",
				"europe",
				"france",
				"francecentral",
				"francesouth",
				"germany",
				"germanynorth",
				"germanywestcentral",
				"global",
				"india",
				"israel",
				"israelcentral",
				"italy",
				"italynorth",
				"japan",
				"japaneast",
				"japanwest",
				"korea",
				"koreacentral",
				"koreasouth",
				"mexicocentral",
				"newzealand",
				"northcentralus",
				"northeurope",
				"norway",
				"norwayeast",
				"norwaywest",
				"poland",
				"polandcentral",
				"qatar",
				"qatarcentral",
				"singapore",
				"southafrica",
				"southafricanorth",
				"southafricawest",
				"southcentralus",
				"southeastasia",
				"southindia",
				"spaincentral",
				"sweden",
				"swedencentral",
				"switzerland",
				"switzerlandnorth",
				"switzerlandwest",
				"uaecentral",
				"uaenorth",
				"uksouth",
				"ukwest",
				"unitedstates",
				"westcentralus",
				"westeurope",
				"westindia",
				"westus",
				"westus2",
				"westus3"
			]
		},
		"enableAcceleratedNetworking": {
			"type": "bool"
		},
		"virtualNetworkName": {
			"type": "string",
			"defaultValue": ""
		},
		"subnetName": {
			"type": "string",
			"defaultValue": ""
		},
		"networkInterfaceName": {
			"type": "string",
			"defaultValue": "[variables('nicName')]"
		},
		"publicIpAddressName": {
			"type": "string",
			"defaultValue": "[variables('pipName')]"
		},
		"publicIpAddressType": {
			"type": "string"
		},
		"publicIpAddressSku": {
			"type": "string"
		},
		"pipDeleteOption": {
			"type": "string"
		},
		"virtualMachineName": {
			"type": "string"
		},
		"osDiskType": {
			"type": "string",
			"defaultValue": "StandardSSD_LRS",
			"allowedValues": [
				"Standard_LRS",
				"StandardSSD_LRS",
				"StandardSSD_ZRS",
				"Premium_LRS",
				"Premium_ZRS",
				"UltraSSD_LRS"
			],
			"metadata": {
				"description": "The OS disk tier."
			}
		},
		"osDiskDeleteOption": {
			"type": "string"
		},
		"virtualMachineSize": {
			"type": "string"
		},
		"nicDeleteOption": {
			"type": "string"
		},
		"isHibernationEnabled": {
			"type": "bool"
		},
		"adminUsername": {
			"type": "string"
		},
		"adminPublicKey": {
			"type": "secureString",
			"defaultValue": null
		},
		"securityType": {
			"type": "string"
		},
		"isSecureBootEnabled": {
			"type": "bool"
		},
		"isVTpmEnabled": {
			"type": "bool"
		},
		"virtualMachineZone": {
			"type": "string"
		},
		"osImageReference": {
			"type": "object",
			"defaultValue": {
				"publisher": "canonical",
				"offer": "ubuntu-24_04-lts",
				"sku": "server-arm64",
				"version": "latest"
			}
		},
		"resourceTags": {
			"type": "object"
		}
	},
	"variables": {
		"vnetId": "[concat(resourceGroup().id, '/providers/Microsoft.Network/virtualNetworks/', parameters('virtualNetworkName'))]",
		"subnetRef": "[concat(variables('vnetId'), '/subnets/', parameters('subnetName'))]",
		"nicName": "[concat(parameters('virtualMachineName'), '-nic')]",
		"pipName": "[concat(parameters('virtualMachineName'),'-ip')]"
	},
	"resources": [
		{
			"name": "[parameters('networkInterfaceName')]",
			"type": "Microsoft.Network/networkInterfaces",
			"apiVersion": "2022-11-01",
			"location": "[parameters('location')]",
			"dependsOn": [
				"[concat('Microsoft.Network/publicIpAddresses/', parameters('publicIpAddressName'))]"
			],
			"properties": {
				"ipConfigurations": [
					{
						"name": "ipconfig1",
						"properties": {
							"subnet": {
								"id": "[variables('subnetRef')]"
							},
							"privateIPAllocationMethod": "Dynamic",
							"publicIpAddress": {
								"id": "[resourceId(resourceGroup().name, 'Microsoft.Network/publicIpAddresses', parameters('publicIpAddressName'))]",
								"properties": {
									"deleteOption": "[parameters('pipDeleteOption')]"
								}
							}
						}
					}
				],
				"enableAcceleratedNetworking": "[parameters('enableAcceleratedNetworking')]"
			},
			"tags": "[parameters('resourceTags')]"
		},
		{
			"name": "[parameters('publicIpAddressName')]",
			"type": "Microsoft.Network/publicIpAddresses",
			"apiVersion": "2020-08-01",
			"location": "[parameters('location')]",
			"properties": {
				"publicIpAllocationMethod": "[parameters('publicIpAddressType')]"
			},
			"sku": {
				"name": "[parameters('publicIpAddressSku')]"
			},
			"zones": ["[parameters('virtualMachineZone')]"],
			"tags": "[parameters('resourceTags')]"
		},
		{
			"name": "[parameters('virtualMachineName')]",
			"type": "Microsoft.Compute/virtualMachines",
			"apiVersion": "2024-03-01",
			"location": "[parameters('location')]",
			"dependsOn": [
				"[concat('Microsoft.Network/networkInterfaces/', parameters('networkInterfaceName'))]"
			],
			"properties": {
				"hardwareProfile": {
					"vmSize": "[parameters('virtualMachineSize')]"
				},
				"storageProfile": {
					"osDisk": {
						"createOption": "fromImage",
						"managedDisk": {
							"storageAccountType": "[parameters('osDiskType')]"
						},
						"deleteOption": "[parameters('osDiskDeleteOption')]"
					},
					"imageReference": "[parameters('osImageReference')]"
				},
				"networkProfile": {
					"networkInterfaces": [
						{
							"id": "[resourceId('Microsoft.Network/networkInterfaces', parameters('networkInterfaceName'))]",
							"properties": {
								"deleteOption": "[parameters('nicDeleteOption')]"
							}
						}
					]
				},
				"securityProfile": {
					"securityType": "[parameters('securityType')]",
					"uefiSettings": {
						"secureBootEnabled": "[parameters('isSecureBootEnabled')]",
						"vTpmEnabled": "[parameters('isVTpmEnabled')]"
					}
				},
				"additionalCapabilities": {
					"hibernationEnabled": "[parameters('isHibernationEnabled')]"
				},
				"osProfile": {
					"computerName": "[parameters('virtualMachineName')]",
					"adminUsername": "[parameters('adminUsername')]",
					"linuxConfiguration": {
						"disablePasswordAuthentication": true,
						"ssh": {
							"publicKeys": [
								{
									"path": "[concat('/home/', parameters('adminUsername'), '/.ssh/authorized_keys')]",
									"keyData": "[parameters('adminPublicKey')]"
								}
							]
						}
					}
				},
				"diagnosticsProfile": {
					"bootDiagnostics": {
						"enabled": true
					}
				}
			},
			"tags": "[parameters('resourceTags')]",
			"zones": ["[parameters('virtualMachineZone')]"]
		}
	],
	"outputs": {
		"adminUsername": {
			"type": "string",
			"value": "[parameters('adminUsername')]"
		}
	}
}
